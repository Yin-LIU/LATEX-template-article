% customchanges.sty
% A custom LaTeX package for tracking changes with author-specific colors.
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{customchanges}[2024/04/27 v1.0 Custom Changes Package]

% Required packages
\RequirePackage[svgnames,x11names,dvipsnames]{xcolor} % Extended color support
\RequirePackage{xparse}
\RequirePackage[colorinlistoftodos,prependcaption,textsize=small]{todonotes}
\RequirePackage{geometry}
\RequirePackage{authblk}
\RequirePackage{amsmath,amssymb,amsthm}
\RequirePackage{mathtools}
\RequirePackage{xr-hyper,hyperref}
\RequirePackage{algorithm, algorithmic}
\RequirePackage{caption, subcaption}
\RequirePackage{enumerate,enumitem}
\RequirePackage[page,title]{appendix}
\RequirePackage{subfiles}
\RequirePackage{titletoc}
\RequirePackage{graphicx}
\RequirePackage[capitalize,noabbrev]{cleveref}
\RequirePackage{crossreftools}

% Geometry setup
\AtBeginDocument{
  \newgeometry{
    textheight=9in,
    textwidth=6.5in,
    top=1in,
    headheight=14pt,
    headsep=25pt,
    footskip=30pt
  }
}

\renewcommand\Authfont{\bfseries}
\renewcommand\Affilfont{\mdseries \small}

%% Custom title formatting
\makeatletter
\renewcommand{\@maketitle}{%
  \vbox{%
    \vspace*{0in} % Adjust title height as needed
    \hsize\textwidth
    \linewidth\hsize
    \vskip 0.1in
    \centering
    {\LARGE  \textbf{\@title}\par} % Title
    \vskip 0.3in
    {\@author} % Author in normal size
    \vskip 0.2in
    \@date % Date
    \vskip 0.3in
  }
}
\makeatother


% Theorem styles
\theoremstyle{plain}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}

\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{assumption}[theorem]{Assumption}

\theoremstyle{remark}
\newtheorem{remark}[theorem]{Remark}

% Hyperref setup
\hypersetup{
  bookmarksnumbered,
  bookmarksopen=true,
  bookmarksopenlevel=1,
}

% Address cref warnings
\pdfstringdefDisableCommands{
  \let\Cref\crtCref
  \let\cref\crtcref
}

% Author-specific change tracking
\makeatletter
% Define authors and associated colors
\newcommand{\defineauthor}[2]{%
    \@namedef{authorcolor@#1}{#2}%
}

% Added text
\NewDocumentCommand{\added}{o +m}{%
    \IfNoValueTF{#1}{%
        {\color{blue}#2}%
    }{%
        \@ifundefined{authorcolor@#1}{%
            \PackageError{customchanges}{Undefined author ID `#1'}{%
                Please define the author using \string\defineauthor\{#1\}\{color\}.}%
        }{%
            {\color{\csname authorcolor@#1\endcsname}#2}%
        }%
    }%
}

% Replaced text
\NewDocumentCommand{\replaced}{o +m +m}{%
    \IfNoValueTF{#1}{%
        {\color{blue}#2}{\color{blue!20}#3}%
    }{%
        \@ifundefined{authorcolor@#1}{%
            \PackageError{customchanges}{Undefined author ID `#1'}{%
                Please define the author using \string\defineauthor\{#1\}\{color\}.}%
        }{%
            {\color{\csname authorcolor@#1\endcsname}#2}%
            {\color{\csname authorcolor@#1\endcsname!20}#3}%
        }%
    }%
}

% Deleted text
\NewDocumentCommand{\deleted}{o +m}{%
    \IfNoValueTF{#1}{%
        {\color{blue!20}#2}%
    }{%
        \@ifundefined{authorcolor@#1}{%
            \PackageError{customchanges}{Undefined author ID `#1'}{%
                Please define the author using \string\defineauthor\{#1\}\{color\}.}%
        }{%
            {\color{\csname authorcolor@#1\endcsname!20}#2}%
        }%
    }%
}

% Notes
\NewDocumentCommand{\note}{o +m}{%
    \IfNoValueTF{#1}{%
        \todo[linecolor=blue,backgroundcolor=blue!25]{#2}%
    }{%
        \@ifundefined{authorcolor@#1}{%
            \PackageError{customchanges}{Undefined author ID `#1'}{%
                Please define the author using \string\defineauthor\{#1\}\{color\}.}%
        }{%
            \todo[linecolor=\csname authorcolor@#1\endcsname,
                 backgroundcolor=\csname authorcolor@#1\endcsname!25]{#2}%
        }%
    }%
}
\makeatother

\endinput
